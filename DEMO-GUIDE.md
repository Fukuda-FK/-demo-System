# New Relic ワークロード デモガイド

## 🎯 デモの目的

このアプリケーションは、New Relicワークロードの価値を実演するためのデモ用決済システムです。
ボタンクリックで障害を発生させ、New Relicでの監視・原因特定の流れを体験できます。

## 🚀 デモの準備

### 1. アプリケーション起動
```bash
cd app
npm install
npm start
```

### 2. ブラウザでアクセス
```
http://localhost:3000
```

## 📋 デモシナリオ

### シナリオ1: 正常動作の確認

1. **商品一覧**タブで商品をカートに追加
2. **カート**タブで「レジに進む」をクリック
3. 決済情報を入力して「決済を実行」
4. ✅ 正常に決済が完了することを確認

### シナリオ2: フロントエンド障害 (Browser Monitoringデモ)

#### Step 1: フロントエンドエラー発生
1. **🔧 管理画面**タブを開く
2. 「🔴 フロントJSエラー ON」ボタンをクリック
3. 商品をカートに入れて決済を実行
4. ❌ JavaScriptエラーが発生し、フォーム処理が失敗
5. 🎥 **New Relic Browser Monitoring**でJSエラーを確認

#### Step 2: フロントエンド遅延
1. 「🟠 フロント遅延 ON」をクリック
2. 決済を実行（3秒の遅延が発生）
3. 📊 **New Relic Browser Monitoring**でページ読み込み時間の増加を確認

### シナリオ3: バックエンド障害 (APMデモ)

#### Step 1: APIタイムアウトエラー
1. **🔧 管理画面**で「🔴 APIタイムアウト ON」をクリック
2. 決済を実行
3. ❌ バックエンドAPIタイムアウトエラーが発生
4. 📊 **New Relic APM**でタイムアウトエラーを確認

#### Step 2: API遅延
1. 「🟡 API遅延 ON」をクリック
2. 決済を実行（2秒の遅延が発生）
3. 📊 **New Relic APM**で処理時間の増加を確認

### シナリオ4: 複合障害 (ワークロードデモ)

#### Step 1: フロント+バック両方で障害発生
1. 「🔴 フロントJSエラー ON」と「🔴 APIタイムアウト ON」を両方有効化
2. 決済を実行
3. 📊 **New Relicワークロード**で全レイヤーの障害を一目で確認
   - 🔴 User Experience: フロントエンドエラー
   - 🔴 Services: バックエンドAPIエラー
   - 🟢 Infrastructure: インフラは正常

#### Step 2: 復旧
1. 「🟢 フロント正常化」と「🟢 API正常化」で全体を復旧
2. 決済が正常に動作することを確認

## 🛠️ コマンドライン制御

デモ中にコマンドラインからも障害を制御できます：

```bash
# フロントエンド障害
demo-control.bat frontend-error
demo-control.bat frontend-slow
demo-control.bat frontend-normal

# バックエンド障害
demo-control.bat backend-error
demo-control.bat backend-slow
demo-control.bat backend-normal

# 状態確認
demo-control.bat status
```

## 📊 New Relicでの確認ポイント

### ワークロード画面
- **User Experience**: Browser Monitoringでフロントエンドの状態を確認
- **Services**: APMでバックエンドAPIの状態を確認
- **Infrastructure**: インフラの健康状態を確認

### 具体的な確認項目
1. **フロントエンド**: JavaScriptエラー、ページ読み込み時間
2. **バックエンド**: APIエラー率、レスポンス時間
3. **インフラ**: CPU、メモリ、データベース接続
4. **セッションリプレイ**: ユーザーの実際の操作と困った様子

## 🎭 デモのポイント

### 従来の監視との違い
- **Before**: 各担当者が個別に調査（30分）
- **After**: ワークロードで一目で原因特定（2分）

### セッションリプレイの価値
- お客様の実際の困った様子を動画で確認
- 経営層にも分かりやすい可視化
- 問題の深刻度を正確に把握

### エンドツーエンドの可視化
- インフラ ➡️ アプリケーション ➡️ ユーザー体験
- 「点」から「線」への監視の進化

## 🔧 トラブルシューティング

### アプリケーションが起動しない
```bash
# ポート確認
netstat -an | findstr :3000

# プロセス終了
taskkill /f /im node.exe
```

### データベース接続エラー
1. **DBテスト**タブで接続確認
2. PostgreSQLが起動していることを確認
3. 環境変数の設定を確認

### New Relicでデータが見えない
1. `newrelic.js`の設定確認
2. ライセンスキーの確認
3. アプリケーション名の確認

## 📝 デモ後のフォローアップ

### 提案内容
1. **APM導入**: アプリケーション監視の強化
2. **Browser Monitoring**: セッションリプレイの実装
3. **ワークロード設定**: エンドツーエンド可視化
4. **アラート設定**: プロアクティブな監視

### 期待効果
- 障害対応時間: 30分 ➡️ 2分（93%短縮）
- 顧客満足度の向上
- 運用効率の改善
- ビジネス継続性の確保