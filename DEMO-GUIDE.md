# New Relic ワークロード デモガイド

## 🎯 デモの目的

このアプリケーションは、New Relicワークロードの価値を実演するためのデモ用決済システムです。
ボタンクリックで障害を発生させ、New Relicでの監視・原因特定の流れを体験できます。

## 🚀 デモの準備

### 1. アプリケーション起動
```bash
cd app
npm install
npm start
```

### 2. ブラウザでアクセス
```
http://localhost:3000
```

## 📋 デモシナリオ

### シナリオ1: 正常動作の確認

1. **商品一覧**タブで商品をカートに追加
2. **カート**タブで「レジに進む」をクリック
3. 決済情報を入力して「決済を実行」
4. ✅ 正常に決済が完了することを確認

### シナリオ2: 障害発生と原因特定

#### Step 1: 障害発生
1. **🔧 管理画面**タブを開く
2. 「💥 決済エラーモード ON」ボタンをクリック
3. ✅ 障害モードが有効になったことを確認

#### Step 2: 顧客体験（障害の発生）
1. **商品一覧**で商品をカートに追加
2. **カート**から決済に進む
3. 決済を実行
4. ❌ タイムアウトエラーが発生することを確認
5. 🎥 **New Relicセッションリプレイ**でお客様の困った様子を確認

#### Step 3: New Relicワークロードで原因特定
1. New Relicワークロード画面を開く
2. 🔴 User Experience層でアラートを確認
3. 🔴 Services層でアプリケーションエラーを確認
4. 🟢 Infrastructure層は正常であることを確認
5. ➡️ **原因: アプリケーション層の問題**と特定

#### Step 4: 復旧
1. **🔧 管理画面**で「✅ 決済エラーモード OFF」をクリック
2. 決済を再実行して正常動作を確認
3. 🎥 New Relicで復旧を確認

### シナリオ3: パフォーマンス劣化

#### Step 1: スロー障害発生
1. **🔧 管理画面**で「🐌 スローモード ON」をクリック
2. 決済を実行（2秒の遅延が発生）
3. 📊 New RelicのAPMで処理時間の増加を確認

#### Step 2: 復旧
1. **🔧 管理画面**で「⚡ スローモード OFF」をクリック
2. 処理時間が正常に戻ることを確認

## 🛠️ コマンドライン制御

デモ中にコマンドラインからも障害を制御できます：

```bash
# 障害発生
demo-control.bat failure-on

# 障害復旧
demo-control.bat failure-off

# スロー障害
demo-control.bat slow-on

# スロー復旧
demo-control.bat slow-off

# 状態確認
demo-control.bat status
```

## 📊 New Relicでの確認ポイント

### ワークロード画面
- **User Experience**: セッションリプレイでお客様の体験
- **Services**: APMでアプリケーションエラー
- **Infrastructure**: インフラの健康状態

### 具体的な確認項目
1. **エラー率の上昇**
2. **レスポンス時間の増加**
3. **スループットの低下**
4. **セッションリプレイでのユーザー行動**

## 🎭 デモのポイント

### 従来の監視との違い
- **Before**: 各担当者が個別に調査（30分）
- **After**: ワークロードで一目で原因特定（2分）

### セッションリプレイの価値
- お客様の実際の困った様子を動画で確認
- 経営層にも分かりやすい可視化
- 問題の深刻度を正確に把握

### エンドツーエンドの可視化
- インフラ ➡️ アプリケーション ➡️ ユーザー体験
- 「点」から「線」への監視の進化

## 🔧 トラブルシューティング

### アプリケーションが起動しない
```bash
# ポート確認
netstat -an | findstr :3000

# プロセス終了
taskkill /f /im node.exe
```

### データベース接続エラー
1. **DBテスト**タブで接続確認
2. PostgreSQLが起動していることを確認
3. 環境変数の設定を確認

### New Relicでデータが見えない
1. `newrelic.js`の設定確認
2. ライセンスキーの確認
3. アプリケーション名の確認

## 📝 デモ後のフォローアップ

### 提案内容
1. **APM導入**: アプリケーション監視の強化
2. **Browser Monitoring**: セッションリプレイの実装
3. **ワークロード設定**: エンドツーエンド可視化
4. **アラート設定**: プロアクティブな監視

### 期待効果
- 障害対応時間: 30分 ➡️ 2分（93%短縮）
- 顧客満足度の向上
- 運用効率の改善
- ビジネス継続性の確保